FROM debian:bookworm-slim

ARG SUPERCRONIC_VERSION=v0.2.29

RUN apt-get update \
    && DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends \
        bash \
        ca-certificates \
        curl \
        tzdata \
        mariadb-client \
        awscli \
    && rm -rf /var/lib/apt/lists/*

RUN curl -fsSLo /usr/local/bin/supercronic \
    "https://github.com/aptible/supercronic/releases/download/${SUPERCRONIC_VERSION}/supercronic-linux-amd64" \
    && chmod +x /usr/local/bin/supercronic

WORKDIR /app

COPY scripts/mariadb_backup.sh /usr/local/bin/mariadb_backup.sh
COPY ops/backup-entrypoint.sh /ops/backup-entrypoint.sh

ENV TZ=UTC

ENTRYPOINT ["/ops/backup-entrypoint.sh"]
