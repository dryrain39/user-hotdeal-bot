services:
  # Crawler + Telegram Bot service (original)
  crawler:
    image: ghcr.io/krepe90/user-hotdeal-bot:latest
    build:
      context: .
      target: crawler
    container_name: user-hotdeal-bot-crawler
    restart: unless-stopped
    volumes:
      - ./config.yaml:/app/config.yaml:ro
      - ./log:/app/log
      - ./dump.json:/app/dump.json
      - hotdeal-db:/app/data
    environment:
      - TZ=Asia/Seoul
      - DATABASE_URL=sqlite+aiosqlite:///./data/hotdeal.db

  # FastAPI API server
  api:
    image: ghcr.io/krepe90/user-hotdeal-bot:api
    build:
      context: .
      target: api
    container_name: user-hotdeal-bot-api
    restart: unless-stopped
    ports:
      - "8000:8000"
    volumes:
      - hotdeal-db:/app/data
    environment:
      - TZ=Asia/Seoul
      - DATABASE_URL=sqlite+aiosqlite:///./data/hotdeal.db
    depends_on:
      - crawler

volumes:
  hotdeal-db:
